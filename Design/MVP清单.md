# MVP 清单（vibe-test）

## 目标
先完成“可登录 + 可进行一局流程 + 可累计通关次数”的最小闭环。

## 里程碑 1：可登录并进入游戏
- 后端接口：`POST /auth/login_or_create`
- 入参：`account`（可空）
- 逻辑：
  - 有 `account`：查询该账号
  - 无 `account`：生成随机账号并创建
- 出参：`account`、`clear_count`
- 前端（Godot）：
  - 登录页支持输入账号登录
  - 支持“直接创建账号”
  - 登录成功后进入主流程页

### 验收标准
- 输入已有账号可以登录成功
- 不输入账号可创建新账号并登录
- 登录后可拿到并显示 `clear_count`

## 里程碑 2：最小数据闭环
- 数据库最小表：`players`
  - `account`（主键，随机字符串）
  - `clear_count`（默认 `0`）
  - `created_at`
  - `updated_at`
- 后端接口：
  - `GET /player/:account`：读取通关次数
  - `POST /player/:account/clear`：通关次数 `+1`

### 验收标准
- 可以根据 `account` 读取数据
- 完成一局后 `clear_count` 正确加 1 并持久化

## 里程碑 3：单局流程跑通
- 游戏流程状态机（本地先实现）：
  - 初始化
  - 选择心意
  - 生成事件与任务
  - 玩家选择
  - 任务结算
  - 进入下一回合
  - 结束
- `NPC / 任务 / 事件` 先用本地假数据
- 先保证流程可点击推进和结算正确

### 验收标准
- 能完整走完一局流程
- 每个阶段都可进入下一个阶段
- 结束时可触发清算逻辑

## 里程碑 4：公网访问
- 后端部署到可公网访问的域名
- 前端支持 `base_url` 配置切换（本地 / 线上）
- 登录通过域名访问，不依赖手输 IP

### 验收标准
- 本地和线上接口都可切换并正常登录
- 外网环境可完成登录和一次流程

## 建议代码结构（Godot）
- `control.gd`：页面切换与流程编排
- `scripts/net_client.gd`：HTTP 请求封装
- `scripts/game_flow.gd`：回合状态机
- `scripts/models.gd`：玩家 / NPC / 任务 / 事件数据结构

## 推进顺序（建议）
1. 先打通登录接口与登录 UI
2. 再打通 `clear_count` 的读写闭环
3. 接着完成本地单局流程状态机
4. 最后接入公网部署与环境切换
